var RecipeConverter={factor:1,scales:{mg:{limit:1000,next:"gr",round:0,calibration:0.001,canon_unit:"gr",system:"M"},gr:{limit:1000,next:"kg",round:0,calibration:1,canon_unit:"gr",system:"M"},kg:{limit:null,next:null,round:1,calibration:1000,canon_unit:"gr",system:"M"},ml:{limit:1000,next:"liter",round:0,calibration:1,canon_unit:"ml",system:"M"},liter:{limit:null,next:null,round:1,calibration:1000,canon_unit:"ml",system:"M"},mm:{limit:10,next:"cm",round:1,calibration:0.1,canon_unit:"cm",system:"M"},cm:{limit:100,next:"m",round:1,calibration:1,canon_unit:"cm",system:"M"},m:{limit:null,next:null,round:1,calibration:100,canon_unit:"cm",system:"M"},oz:{limit:16,next:"lb",round:1,calibration:28.3495,canon_unit:"gr",system:"US"},lb:{limit:null,next:null,round:1,calibration:453.592,canon_unit:"gr",system:"US"},floz:{limit:16,next:"pint",round:1,calibration:29.573,canon_unit:"ml",system:"US"},pint:{limit:2,next:"quart",round:1,calibration:473.176,canon_unit:"ml",system:"US"},quart:{limit:4,next:"gallon",round:1,calibration:946.352,canon_unit:"ml",system:"US"},gallon:{limit:null,next:null,round:1,calibration:3785.41,canon_unit:"ml",system:"US"},inch:{limit:null,next:null,round:1,calibration:2.54,canon_unit:"cm",system:"US"},tsp:{limit:3,next:"tbsp",round:1,calibration:5,canon_unit:"ml",system:"G"},tbsp:{limit:null,next:null,round:1,calibration:15,canon_unit:"ml",system:"G"},cup:{limit:null,next:null,round:1,calibration:250,canon_unit:"ml",system:"G"},generic:{limit:null,next:null,round:1,calibration:1,canon_unit:null,system:"G"}},modify:function(a,c,d){var b=this.getAllSentences(a);this.factor=c;if(c!=1){this.multiply(b,c)}else{this.convert(b,d)}},multiply:function(a,b){a.each(function(){RecipeConverter.multiplyIngredient(this,b)})},multiplyIngredient:function(a,b){var c=jQuery(a).find(".kb-measure_units");c.each(function(){var d=jQuery(this).children(".kb-number");var i=jQuery(this).children(".kb-unit");if((i).parent().hasClass("kb-no-scale")){return}var g=0;if(jQuery(d).attr("initial-number-value")){g=jQuery(d).attr("initial-number-value")}else{g=jQuery(d).attr("number-value");jQuery(d).attr("initial-number-value",g)}var f=0;var h=0;if(typeof(g)!="undefined"&&g.match(/^[\d\.]+\-[\d\.]+/)){var e=g.split("-");e[0]=e[0]*b;e[1]=e[1]*b;f=e[0]+"-"+e[1];e[0]=Math.round(e[0]*100)/100;e[1]=Math.round(e[1]*100)/100;if(e[0]%1!=0){e[0]=RecipeConverter.fraction(e[0])}if(e[1]%1!=0){e[1]=RecipeConverter.fraction(e[1])}h=e[0]+"-"+e[1]}else{f=g*b;h=Math.round(f*100)/100;if(h%1!=0){h=RecipeConverter.fraction(h)}}d.html(h);d.attr("initial-number-value",f);d.attr("number-value",h)})},doConvert:function(a,b){RecipeConverter.convertIngredient(a,b)},convert:function(a,b){if(jQuery.isArray(a)){a.each(function(){RecipeConverter.doConvert(this,b)})}else{RecipeConverter.doConvert(a,b)}},convertIngredient:function(a,c){var b=jQuery(a).find(".kb-measure_units");b.each(function(){var f=RecipeConverter.canonizeMeasure(this);if(f.system&&f.system!="G"){var e=RecipeConverter.convertMeasure(f.number,f.unit,c);if(e.unit&&RecipeConverter.scales[e.unit].limit&&e.number>=RecipeConverter.scales[e.unit].limit){e.number/=RecipeConverter.scales[e.unit].limit;e.unit=RecipeConverter.scales[e.unit].next}var d=RecipeConverter.roundMeasure(e.number,e.unit);f.number_node.attr("initial-number-value",e.number);f.number_node.attr("number-value",d.number);if(d.number%1!=0){f.number_node.html(RecipeConverter.fraction(e.number))}else{f.number_node.html(d.number)}if(d.unit){f.unit_node.attr("unit-calibration",RecipeConverter.scales[d.unit].calibration);f.unit_node.attr("unit-canon",RecipeConverter.scales[d.unit].canon_unit);f.unit_node.html(d.unit)}}})},canonizeMeasure:function(e){var b=jQuery(e).children(".kb-number");var h=jQuery(e).children(".kb-unit");var f=jQuery(b).attr("initial-number-value");if(!h.length){return{number:f,unit:null,number_node:b,system:"G"}}var c=jQuery(h).attr("unit-canon");var d=jQuery(h).attr("unit-calibration");var a=jQuery(h).attr("unit-system");if(a=="G"){return{number:f,number_node:b,system:a}}else{var g=f*d;return{number:g,unit:c,number_node:b,unit_node:h,system:a}}},convertMeasure:function(b,a,c){if(c=="US"){if(a=="ml"){b*=0.0338140227;a="floz"}if(a=="gr"){b*=0.0352739619;a="oz"}if(a=="cm"){b*=0.393701;a="inch"}return{number:b,unit:a}}else{return{number:b,unit:a}}},roundMeasure:function(d,c){c=c||"generic";var a=true;var b=Math.pow(10,this.scales[c].round);do{if(d<10){if(d>=0.2){if(d!=Math.round(d*10)/10){d=Math.round(d*10)/10;a=true}else{a=false}}else{d=Math.round(d*Math.pow(10,2))/Math.pow(10,2);a=false}}else{if(d!=Math.round(d*b)/b){d=Math.round(d*b)/b;a=true}else{a=false}}}while(a);return{number:d,unit:c}},getAllIngredients:function(a){return jQuery(a).find(".kb-full_ingredient")},getAllSentences:function(a){return jQuery(a).find(".kb-sentence")},fraction:function(a){var d,c,a;var f=" ";var e=new Array(0.15,0.25,0.33,0.5,0.66,0.75,0.86);var b=new Array("","1/4","1/3","1/2","2/3","3/4","");c=String(a).split(".")[0];a=parseFloat("."+String(a).split(".")[1]);for(ind=0;ind<e.length;ind++){d=ind;if(e[ind]>=a){if((ind>0)&&(Math.abs(e[ind]-a)>Math.abs(e[ind-1]-a))){d=ind-1}if(ind==0){d=1}ind=e.length}}if(d==e.length-1){c=parseFloat(c)+1}if(d==0||d==6){f=""}return((c==0)?"":c+f)+b[d]}};