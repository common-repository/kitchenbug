var WikiBubble={initTabs:function(){jQuery(".kb-with-wiki").click(function(){wikilinksOn=jQuery(".kb-ingredients-container UL").data("wikilinkson");if(wikilinksOn=="off"){return false}var c=jQuery(this).closest(".kb-recipe-container");var e=c.attr("recipe-id");var f=jQuery(this).text().replace(/\s+/g," ");var a=c.find(".kb-wiki-bubble");var g=WikiBubble.getIngredientDescription(e,f);if(!g){return false}WikiBubble.populate(c,g);jQuery(".kb-wiki-bubble").each(function(){jQuery(this).hide()});WikiBubble.showEntry();jQuery(".bubble-open").removeClass("bubble-open");jQuery(this).addClass("bubble-open");var d=jQuery(this).position();var b=jQuery(this).height();a.css({top:(d.top+b)+"px",left:(d.left-20)+"px"}).show();jQuery(document).bind("keyup","esc",WikiBubble.close);return false});jQuery(".kb-wiki-bubble-facts-btn").click(function(){WikiBubble.showFacts();return false});jQuery(".kb-wiki-bubble-entry-btn").click(function(){WikiBubble.showEntry();return false});jQuery("html").bind("click touchstart",function(){WikiBubble.close()})},showEntry:function(){jQuery(".kb-wiki-bubble-entry").show();jQuery(".kb-wiki-bubble-nutfacts").hide();jQuery(".kb-wiki-bubble-facts-btn").show();jQuery(".kb-wiki-bubble-entry-btn").hide()},showFacts:function(){jQuery(".kb-wiki-bubble-entry").hide();jQuery(".kb-wiki-bubble-nutfacts").show();jQuery(".kb-wiki-bubble-facts-btn").hide();jQuery(".kb-wiki-bubble-entry-btn").show()},getIngredientDescription:function(b,c){var e=null;var d=recipeData[b].ingredientDescriptions;c=c.replace(/^\s+|\s+$/g,"");c=c.replace(/[â€™']/,"'");c=c.replace(/[&]/,"&#038;");for(var a=0;a<d.length;a++){if(d[a].name.toLowerCase()==c.toLowerCase()){e=d[a];a=d.length}}return e},populate:function(k,b){var f=k.find("a.kb-wiki-bubble-more-btn");var a=k.find("h2.kb-wiki-bubble-title");var c=k.find("span.kb-horizontal-nutrition-title");var d=k.find("p.kb-wiki-bubble-description");var j=k.find("img.kb-wiki-bubble-image");var e=k.find("span.kb-horizontal-nutrition-calories");var o=k.find("span.kb-horizontal-nutrition-fat-calories");var g=k.find(".kb-horizontal-nutrition-table");var n=k.find(".kb-horizontal-nutrition-vitamins");a.html("");c.html("");d.html("");f.attr("href","");j.attr("src","");g.html("");n.html("");a.html(b.title);c.html(b.title);d.html(b.description);f.attr("href",b.url);if(b.imageUrl=="null"||b.imageUrl==""||b.imageUrl==null){j.hide()}else{j.show();j.attr("src",b.imageUrl)}if(b.nutFacts){e.html(b.nutFacts["208"].value);o.html(b.nutFacts.cal_from_fat);for(var h in b.nutFacts){var m=b.nutFacts[h];var l="";if(h=="208"||h=="cal_from_fat"||h=="cal_from_fat100"){continue}var l=m.desc+" "+Math.round(m.value*10)/10+m.units;jQuery("<span/>",{"class":"kb-horizontal-nutrition-single-fact",text:l}).appendTo(g)}}jQuery(".kb-horizontal-nutrition-single-fact:last").addClass("last")},close:function(){var a=jQuery(".bubble-open");if(a.length>0){jQuery(".kb-wiki-bubble").each(function(){jQuery(this).hide()});a.removeClass("bubble-open");jQuery(document).unbind("keyup",WikiBubble.close)}}};